<!DOCTYPE html>	
<html>
	<head>
		<link rel="stylesheet" href="Test.css">
	</head>
    <body style='overflow-x: hidden;'>
        <header>
        </header>
        <script>
            var img = new Image();
            img.width = 250;
            img.height = 125;
            img.onload = function() {
                var screenMiddleX = window.innerWidth/2;
                var screenMiddleY = window.innerHeight/2;
                var rectangleSizeX = screenMiddleX/10;
                var rectangleSizeY = screenMiddleY/10;
                var xRepetition = Math.ceil(screenMiddleX/rectangleSizeX);
                var yRepetition = Math.ceil(screenMiddleY/rectangleSizeY);
                var canvas = document.createElement('canvas');
                var context = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                context.drawImage(img, 0, 0);
                var imgData = context.getImageData(0, 0, img.width, img.height);
                console.log("imgData length = " + imgData.data.length);
                console.log((xRepetition*4) + " " + (yRepetition*4) + " " + ((xRepetition*4)*(yRepetition*4)));
                for(var i = 0; i < imgData.data.length; i+=4){
                    datas.push(imgData.data[i]);
                }
                colorShift();
            };
            img.src = "Perlin.png";

            var screenMiddleX = window.innerWidth/2;
            var screenMiddleY = window.innerHeight/2;
            var rectangleSizeX = 131;
            var rectangleSizeY = 77;

            var xRepetition = Math.ceil(screenMiddleX/rectangleSizeX);
            var yRepetition = Math.ceil(screenMiddleY/rectangleSizeY);

            var startPositionX = screenMiddleX-xRepetition*rectangleSizeX;
            var startPositionY = screenMiddleY-yRepetition*rectangleSizeY;

            var newSvg = document.querySelector('header');
            newSvg.outerHTML += '<svg id="grid" width="' + window.innerWidth + '" height="' + window.innerHeight + '"></svg>';
            
            var Ax,Bx,Cx,Dx,Ex;
            var Ay,By,Cy,Dy,Ey;

            var table = [];

            var leftSide = true;
            var rightSide = false;
            
            for(var y = 0; y < yRepetition*2; y++){
                for(var x = 0; x < xRepetition*2; x++){
                    Ax = startPositionX + rectangleSizeX*x;
                    Ay = startPositionY + rectangleSizeY*y;
                    Bx = startPositionX + rectangleSizeX + rectangleSizeX*x;
                    By = startPositionY + rectangleSizeY*y;
                    Cx = startPositionX  + rectangleSizeX*x;
                    Cy = startPositionY + rectangleSizeY + rectangleSizeY*y;
                    Dx = startPositionX + rectangleSizeX  + rectangleSizeX*x;
                    Dy = startPositionY + rectangleSizeY + rectangleSizeY*y;
                    Ex = startPositionX + rectangleSizeX/2  + rectangleSizeX*x;
                    Ey = startPositionY + rectangleSizeY/2 + rectangleSizeY*y;

                    var left = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    left.setAttribute('d','M'+ Ax + ' ' + Ay + 
                                          ' L' + Ex + ' ' + Ey + 
                                          ' L' + Cx + ' ' + Cy + ' Z');
                    left.style.fill = '#000000';
                    left.style.stroke = 'white';
                    left.style.strokeWidth = '1';
                    document.getElementById('grid').appendChild(left);

                    var up = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    up.setAttribute('d','M'+ Ax + ' ' + Ay + 
                                        ' L' + Bx + ' ' + By + 
                                        ' L' + Ex + ' ' + Ey + ' Z');
                    up.style.fill = '#000000';
                    up.style.stroke = 'white';
                    up.style.strokeWidth = '1';
                    document.getElementById('grid').appendChild(up);

                    var right = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    right.setAttribute('d','M'+ Bx + ' ' + By + 
                                            ' L' + Dx + ' ' + Dy + 
                                            ' L' + Ex + ' ' + Ey + ' Z');
                    right.style.fill = '#000000';
                    right.style.stroke = 'white';
                    right.style.strokeWidth = '1';
                    document.getElementById('grid').appendChild(right);

                    var down = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    down.setAttribute('d','M'+ Cx + ' ' + Cy + 
                                          ' L' + Ex + ' ' + Ey + 
                                          ' L' + Dx + ' ' + Dy + ' Z');
                    down.style.fill = '#000000';
                    down.style.stroke = 'white';
                    down.style.strokeWidth = '1';
                    document.getElementById('grid').appendChild(down);

                    if(leftSide){
                        table.push([left, up]);
                        table.push([down, right]);
                    } else if(rightSide){
                        table.push([left, down]);
                        table.push([up, right]);
                    }
                }
                if(leftSide){
                    leftSide = false;
                    rightSide = true;
                } else if(rightSide){
                    leftSide = true;
                    rightSide = false;
                }
            }

            function colorPixel(table, index, color){
                table[index][0].style.fill = color;
                table[index][1].style.fill = color;
            };

            function componentToHex(c) {
                var hex = c.toString(16);
                return hex.length == 1 ? "0" + hex : hex;
            }

            function rgbToHex(r, g, b) {
                return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
            }

            var xOffset = 0;
            var yOffset = 0;
            var datas = [];

            var colors = [[255,153,0,255,255,0],
                        [0,255,0,51,204,255],
                        [51,204,255,255,51,204],
                        [255,51,204,255,153,0],
                        [255,255,0,51,204,255],
                        [255,255,0,0,255,0],
                        [255,255,0,255,51,204]];

            var rand = Math.floor(Math.random() * Math.floor(colors.length));

            function colorShift(){
                for(var y = 0, i = 0, j = 0; y < yRepetition*4; y++, i+=250-xRepetition*4){
                    for(var x = 0; x < xRepetition*4; x++, i++, j++){
                        var value1;
                        if(i+xOffset+yOffset < datas.length){
                            value1 = 0.9*Math.abs(datas[i+xOffset+yOffset]-255)/255;
                        } else {
                            value1 = 0.9*Math.abs(datas[i]-255)/255;
                        }
                        if(i+50+xOffset+yOffset < datas.length){
                            value2 = 0.9*Math.abs(datas[i+50+xOffset+yOffset]-255)/255;
                        } else {
                            value2 = 0.9*Math.abs(datas[i+50]-255)/255;
                        }

                        console.log("x " + x + " y " + y + " = " + value1);
                        console.log("x " + x + " y " + y + " = " + value2);

                        var R1 = 255-Math.abs(value1)*(255-colors[rand][0]);
                        var G1 = 255-Math.abs(value1)*(255-colors[rand][1]);
                        var B1 = 255-Math.abs(value1)*(255-colors[rand][2]);

                        var R2 = 255-Math.abs(value2)*(255-colors[rand][3]);
                        var G2 = 255-Math.abs(value2)*(255-colors[rand][4]);
                        var B2 = 255-Math.abs(value2)*(255-colors[rand][5]);

                        hex = rgbToHex(Math.floor(R1/2 + R2/2), Math.floor(G1/2 + G2/2), Math.floor(B1/2 + B2/2));
                        if(j < table.length){
                            colorPixel(table, j, hex);
                        }
                    }
                }
                xOffset += 1;
                yOffset += 250;
            }

            setInterval(colorShift,1000);
        </script>
	</body>
</html>