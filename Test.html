<!DOCTYPE html>	
<html>
	<head>
		<link rel="stylesheet" href="Test.css">
	</head>
    <body style='overflow-x: hidden;'>
        <img id="scream" src="Perlin.png" alt="The Scream" width="2048" height="2048">
        <canvas id="myCanvas" width="2048" height="2048" style="border:1px solid #d3d3d3;">
        Your browser does not support the HTML5 canvas tag.</canvas>
        <header>
        </header>
        <script>
            var screenMiddleX = window.innerWidth/2;
            var screenMiddleY = window.innerHeight/2;
            var rectangleSizeX = screenMiddleX/10;
            var rectangleSizeY = screenMiddleY/10;

            var xRepetition = Math.ceil(screenMiddleX/rectangleSizeX);
            var yRepetition = Math.ceil(screenMiddleY/rectangleSizeY);

            var startPositionX = screenMiddleX-xRepetition*rectangleSizeX;
            var startPositionY = screenMiddleY-yRepetition*rectangleSizeY;

            var newSvg = document.querySelector('header');
            newSvg.outerHTML += '<svg id="grid" width="' + window.innerWidth + '" height="' + window.innerHeight + '"></svg>';
            
            var Ax,Bx,Cx,Dx,Ex;
            var Ay,By,Cy,Dy,Ey;

            var table = [];

            var leftSide = true;
            var rightSide = false;
            
            for(var y = 0; y < yRepetition*2; y++){
                for(var x = 0; x < xRepetition*2; x++){
                    Ax = startPositionX + rectangleSizeX*x;
                    Ay = startPositionY + rectangleSizeY*y;
                    Bx = startPositionX + rectangleSizeX + rectangleSizeX*x;
                    By = startPositionY + rectangleSizeY*y;
                    Cx = startPositionX  + rectangleSizeX*x;
                    Cy = startPositionY + rectangleSizeY + rectangleSizeY*y;
                    Dx = startPositionX + rectangleSizeX  + rectangleSizeX*x;
                    Dy = startPositionY + rectangleSizeY + rectangleSizeY*y;
                    Ex = startPositionX + rectangleSizeX/2  + rectangleSizeX*x;
                    Ey = startPositionY + rectangleSizeY/2 + rectangleSizeY*y;

                    var left = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    left.setAttribute('d','M'+ Ax + ' ' + Ay + 
                                          ' L' + Ex + ' ' + Ey + 
                                          ' L' + Cx + ' ' + Cy + ' Z');
                    left.style.fill = '#000000';
                    left.style.stroke = 'white';
                    left.style.strokeWidth = '1';
                    document.getElementById('grid').appendChild(left);

                    var up = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    up.setAttribute('d','M'+ Ax + ' ' + Ay + 
                                        ' L' + Bx + ' ' + By + 
                                        ' L' + Ex + ' ' + Ey + ' Z');
                    up.style.fill = '#000000';
                    up.style.stroke = 'white';
                    up.style.strokeWidth = '1';
                    document.getElementById('grid').appendChild(up);

                    var right = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    right.setAttribute('d','M'+ Bx + ' ' + By + 
                                            ' L' + Dx + ' ' + Dy + 
                                            ' L' + Ex + ' ' + Ey + ' Z');
                    right.style.fill = '#000000';
                    right.style.stroke = 'white';
                    right.style.strokeWidth = '1';
                    document.getElementById('grid').appendChild(right);

                    var down = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    down.setAttribute('d','M'+ Cx + ' ' + Cy + 
                                          ' L' + Ex + ' ' + Ey + 
                                          ' L' + Dx + ' ' + Dy + ' Z');
                    down.style.fill = '#000000';
                    down.style.stroke = 'white';
                    down.style.strokeWidth = '1';
                    document.getElementById('grid').appendChild(down);

                    if(leftSide){
                        table.push([left, up]);
                        table.push([down, right]);
                    } else if(rightSide){
                        table.push([left, down]);
                        table.push([up, right]);
                    }
                }
                if(leftSide){
                    leftSide = false;
                    rightSide = true;
                } else if(rightSide){
                    leftSide = true;
                    rightSide = false;
                }
            }

            function colorPixel(table, index, color){
                table[index][0].style.fill = color;
                table[index][1].style.fill = color;
            };

            function componentToHex(c) {
                var hex = c.toString(16);
                return hex.length == 1 ? "0" + hex : hex;
            }

            function rgbToHex(r, g, b) {
                return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
            }

            var xOffset = 0;
            var yOffset = 0;
            var datas = [];

            function colorShift(){
                var i = 0;
                for(var y = 0; y < yRepetition*4; y++){
                    for(var x = 0; x < xRepetition*4; x++, i++){
                        var value1 = datas[i*20]/255;
                        //var value2 = datas[datas.length-i*20]/255;

                        console.log(datas[i*20]);

                        var R1 = 255-Math.abs(value1)*(255-180);
                        var G1 = 255-Math.abs(value1)*(255-5);
                        var B1 = 255-Math.abs(value1)*(255-255);

                        var R2 = 255-Math.abs(value1)*(255-5);
                        var G2 = 255-Math.abs(value1)*(255-180);
                        var B2 = 255-Math.abs(value1)*(255-255);

                        hex = rgbToHex(Math.floor(R1/2 + R2/2), Math.floor(G1/2 + G2/2), Math.floor(B1/2 + B2/2));
                        if(i < table.length){
                            colorPixel(table, i, hex);
                        }
                    }
                }
            }

           
            document.getElementById("scream").onload = function() {
                console.log("image loaded !");
                var canvas = document.createElement('canvas');
                var context = canvas.getContext('2d');
                var img = document.getElementById("scream");
                canvas.width = img.width;
                canvas.height = img.height;
                context.drawImage(img, 0, 0 );
                var imgData = context.getImageData(0, 0, img.width, img.height);
                console.log("imgData length = " + imgData.data.length);
                for(var i = 0; i < imgData.data.length; i += 4){
                    datas.push(imgData.data[i]);
                }
                colorShift();
            };

            //setInterval(colorShift,1000);
        </script>
	</body>
</html>